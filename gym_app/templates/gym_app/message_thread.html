<!-- gym_app/templates/gym_app/message_thread.html -->

{% extends 'gym_app/base_generic.html' %}

{% block content %}
<h2>Chat with {{ other_user.username }}</h2>

<div class="message-thread">
    {% for msg in chat_messages %}  <!-- 修改这里，将 'messages' 改为 'chat_messages' -->
        <div class="message {% if msg.sender == request.user %}sent{% else %}received{% endif %}">
            <p>{{ msg.content }}</p>
            <p class="timestamp">{{ msg.timestamp|date:"M d, Y H:i" }}</p>
            {% if msg.sender == request.user %}
                <p>
                    <a href="{% url 'update_message' message_id=msg.id %}" class="button">Edit</a>
                    <a href="{% url 'delete_message' message_id=msg.id %}" class="button delete-button">Delete</a>
                </p>
            {% endif %}
        </div>
    {% empty %}
        <p>No messages yet.</p>
    {% endfor %}
</div>

<form method="post" class="chat-form">
    {% csrf_token %}
    {{ form.non_field_errors }}
    {{ form.content.errors }}
    {{ form.content }}
    <button type="submit" class="send-button">Send</button>
</form>
{% endblock %}
